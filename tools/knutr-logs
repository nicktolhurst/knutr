#!/usr/bin/env bash
# ──────────────────────────────────────────────────────────────
# knutr-logs  –  Tail colorized logs from all knutr services
#
# Each service embeds its own colored name via Serilog, so
# there is no need for kubectl's --prefix flag.
#
# Usage:
#   knutr-logs              # last 100 lines, then follow
#   knutr-logs 20           # last 20 lines, then follow
#   knutr-logs --no-follow  # dump recent logs and exit
# ──────────────────────────────────────────────────────────────
set -euo pipefail

NAMESPACE="${KNUTR_NAMESPACE:-knutr}"
TAIL="${1:-100}"
FOLLOW="-f"

if [[ "${1:-}" == "--no-follow" ]]; then
    FOLLOW=""
    TAIL="${2:-100}"
fi

exec kubectl -n "$NAMESPACE" logs \
    -l app.kubernetes.io/part-of=knutr \
    $FOLLOW \
    --tail="$TAIL" \
    --max-log-requests=10
